namespace = uthgar

character_event = {
	id = uthgar.1
	desc = UTHGAR.1
	picture = GFX_evt_angels_1
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_black_lion }
				}
			}
		}
		name = UTHGAR.1.a
		add_trait = uthgar_black_lion
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_black_raven }
				}
			}
		}
		name = UTHGAR.1.b
		add_trait = uthgar_black_raven
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_blue_bear }
				}
			}
		}
		name = UTHGAR.1.c
		add_trait = uthgar_blue_bear
	}
	option = {
		name = TB_OPT_MORE
		character_event = { id = uthgar.2 }
	}
}

character_event = {
	id = uthgar.2
	desc = UTHGAR.1
	picture = GFX_evt_angels_1
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_elk }
				}
			}
		}
		name = UTHGAR.2.a
		add_trait = uthgar_elk
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_gray_wolf }
				}
			}
		}
		name = UTHGAR.2.b
		add_trait = uthgar_gray_wolf
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_great_worm }
				}
			}
		}
		name = UTHGAR.2.c
		add_trait = uthgar_great_worm
	}
	option = {
		name = TB_OPT_MORE
		character_event = { id = uthgar.3 }
	}
}

character_event = {
	id = uthgar.3
	desc = UTHGAR.1
	picture = GFX_evt_angels_1
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_griffon }
				}
			}
		}
		name = UTHGAR.3.a
		add_trait = uthgar_griffon
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_red_tiger }
				}
			}
		}
		name = UTHGAR.3.b
		add_trait = uthgar_red_tiger
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_sky_pony }
				}
			}
		}
		name = UTHGAR.3.c
		add_trait = uthgar_sky_pony
	}
	option = {
		name = TB_OPT_MORE
		character_event = { id = uthgar.4 }
	}
}

character_event = {
	id = uthgar.4
	desc = UTHGAR.1
	picture = GFX_evt_angels_1
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_thunderbeast }
				}
			}
		}
		name = UTHGAR.4.a
		add_trait = uthgar_thunderbeast
	}
	option = {
		trigger = {
			year = 1368
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				any_liege = {
					has_uthgardt_totem = yes
					NOT = { trait = uthgar_tree_ghost }
				}
			}
		}
		name = UTHGAR.4.b
		add_trait = uthgar_tree_ghost
	}
	option = {
		trigger = {
			ai = no
		}
		name = TB_OPT_BACK
		character_event = { id = uthgar.1 }
	}
}

character_event = {
	id = uthgar.5
	desc = UTHGAR.5
	picture = GFX_evt_viking_throneroom_oldgods
	
	trigger = {
		religion = uthgardt_faith
		NOT = { has_character_modifier = uthgardt_bad_tribe }
		OR = {
			AND = {
				FROM = {
					title = d_black_lion
				}
				NOT = { trait = uthgar_black_lion }
			}
			AND = {
				FROM = {
					title = d_black_raven
				}
				NOT = { trait = uthgar_black_raven }
			}
			AND = {
				has_landed_title = d_blue_bear
				NOT = { trait = uthgar_blue_bear }
			}
			AND = {
				FROM = {
					title = d_elk
				}
				NOT = { trait = uthgar_elk }
			}
			AND = {
				FROM = {
					title = d_gray_wolf
				}
				NOT = { trait = uthgar_gray_wolf }
			}
			AND = {
				FROM = {
					title = d_great_worm
				}
				NOT = { trait = uthgar_great_worm }
			}
			AND = {
				FROM = {
					title = d_griffon
				}
				NOT = { trait = uthgar_griffon }
			}
			AND = {
				FROM = {
					title = d_red_tiger
				}
				NOT = { trait = uthgar_red_tiger }
			}
			AND = {
				FROM = {
					title = d_sky_pony
				}
				NOT = { trait = uthgar_sky_pony }
			}
			AND = {
				FROM = {
					title = d_thunderbeast
				}
				NOT = { trait = uthgar_thunderbeast }
			}
			AND = {
				FROM = {
					title = d_tree_ghost
				}
				NOT = { trait = uthgar_tree_ghost }
			}
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.5.a
		if = { # to prevent piety farming
			limit = {
				NOT = { has_character_flag = uth_returned_tribe }
				had_character_flag = {
					flag = uth_returned_tribe
					years = 2
				}
			}
			piety = 150
		}
		clr_character_flag = uth_returned_tribe
		set_character_flag = uth_returned_tribe # refreshing the flag
		custom_tooltip = {
			text = RETURNTRIBETT
			hidden_tooltip = {
				if = {
					limit = {
						num_of_count_titles = 2
					}
					create_character = {
						age = 25
						trait = creature_human
						female = random
						religion = uthgardt_faith
						culture = uthgardt
						dynasty = actually_culture
						random_traits = yes
					}
					new_character = {
						grant_title = FROM
						if = {
							limit = {
								ROOT = {
									OR = {
										tier = KING
										tier = EMPEROR
									}
								}
							}
							set_defacto_liege = ROOT
						}
						else_if = {
							limit = {
								ROOT = {
									NOR = {
										tier = KING
										tier = EMPEROR
									}
								}
							}
							set_defacto_liege = THIS
						}
					}
				}
				else_if = {
					limit = {
						NOT = { num_of_count_titles = 2 }
					}
					destroy_landed_title = FROM
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				NOR = {
					trait = zealous
					trait = humble
				}
			}
		}
		name = UTHGAR.5.b
		add_character_modifier = {
			name = uthgardt_bad_tribe
			duration = -1
		}
	}
}

character_event = {
	id = uthgar.6
	hide_window = yes
	
	trigger = {
		has_character_modifier = uthgardt_bad_tribe
		NOT = { religion = uthgardt_faith }
	}
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = uthgardt_bad_tribe
	}
}

character_event = {
	id = uthgar.7
	hide_window = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = uthgardt_bad_tribe
			religion = uthgardt_faith
			NOR = {
				AND = {
					FROM = {
						title = d_black_lion
					}
					NOT = { trait = uthgar_black_lion }
				}
				AND = {
					FROM = {
						title = d_black_raven
					}
					NOT = { trait = uthgar_black_raven }
				}
				AND = {
					has_landed_title = d_blue_bear
					NOT = { trait = uthgar_blue_bear }
				}
				AND = {
					FROM = {
						title = d_elk
					}
					NOT = { trait = uthgar_elk }
				}
				AND = {
					FROM = {
						title = d_gray_wolf
					}
					NOT = { trait = uthgar_gray_wolf }
				}
				AND = {
					FROM = {
						title = d_great_worm
					}
					NOT = { trait = uthgar_great_worm }
				}
				AND = {
					FROM = {
						title = d_griffon
					}
					NOT = { trait = uthgar_griffon }
				}
				AND = {
					FROM = {
						title = d_red_tiger
					}
					NOT = { trait = uthgar_red_tiger }
				}
				AND = {
					FROM = {
						title = d_sky_pony
					}
					NOT = { trait = uthgar_sky_pony }
				}
				AND = {
					FROM = {
						title = d_thunderbeast
					}
					NOT = { trait = uthgar_thunderbeast }
				}
				AND = {
					FROM = {
						title = d_tree_ghost
					}
					NOT = { trait = uthgar_tree_ghost }
				}
			}
		}
	}
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = { remove_character_modifier = uthgardt_bad_tribe }
	}
}

character_event = {
	id = uthgar.8
	hide_window = yes
	
	trigger = {
		religion = uthgardt_faith
		OR = {
			z_wizard = yes
			z_sorcerer = yes
			z_warlock = yes
			z_bard = yes
		}
		NOT = { has_character_modifier = uthgardt_magician }
	}
	
	is_triggered_only = yes
	
	immediate = {
		add_character_modifier = {
			name = uthgardt_magician
			duration = -1
		}
	}
}

character_event = {
	id = uthgar.9
	hide_window = yes
	
	trigger = {
		religion = uthgardt_faith
		has_character_modifier = uthgardt_magician
	}
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = uthgardt_magician
	}
}

character_event = {
	id = uthgar.10
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = attending_runemeet
	}
}

character_event = {
	id = uthgar.11
	desc = UTHGAR.11
	picture = GFX_evt_viking_throneroom_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.11.a
		add_trait = travelling
		if = {
			limit = {
				location = {
					title = c_night_trees
				}
			}
			character_event = { id = uthgar.12 } # no travel time if already there!
			break = yes
		}
		character_event = { id = uthgar.12 random = 10 }
	}
}

character_event = {
	id = uthgar.12
	desc = UTHGAR.12
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.12.a
		character_event = { id = uthgar.14 }
	}
	
	option = {
		name = UTHGAR.12.b
		hidden_tooltip = {
			random_list = {
				5 = { # + General Opinion
					modifier = {
						factor = 3
						diplomacy = 10
					}
					character_event = { id = uthgar.23 days = 3 }
				}
				3 = { # - General Opinion
					modifier = {
						factor = 3
						NOT = { diplomacy = 5 }
					}
					character_event = { id = uthgar.24 days = 3 }
				}
				5 = { # No success either way
					character_event = { id = uthgar.25 days = 3 }
				}
			}
		}
	}
	
	option = {
		name = UTHGAR.12.c
		scaled_piety = {
			value = 0.5
			min = 50
			max = 300
		}
		scaled_prestige = {
			value = -0.25
			min = 25
			max = 150
		}
		character_event = { id = uthgar.13 random = 5 }
	}
}

character_event = {
	id = uthgar.13
	desc = UTHGAR.13
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.13.a
		remove_trait = travelling
	}
}

character_event = {
	id = uthgar.14
	desc = UTHGAR.14
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.14.a
		character_event = { id = uthgar.15 days = 3 }
	}
}

character_event = {
	id = uthgar.15
	desc = UTHGAR.15
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.15.a
		hidden_tooltip = {
			random_list = {
				15 = { # You do well
					modifier = {
						factor = 2
						combat_rating = 15
					}
					character_event = { id = uthgar.16 }
				}
				15 = { # You lose craven
					modifier = {
						factor = 2
						combat_rating = 15
					}
					modifier = {
						factor = 0
						NOT = { trait = craven }
					}
					character_event = { id = uthgar.17 }
				}
				15 = { # You become brave
					modifier = {
						factor = 2
						combat_rating = 15
					}
					modifier = {
						factor = 0
						OR = {
							trait = craven
							trait = brave
						}
					}
					character_event = { id = uthgar.18 }
				}
				15 = { # You become berserker
					modifier = {
						factor = 2
						combat_rating = 15
					}
					modifier = {
						factor = 0
						OR = {
							trait = berserker
							NOT = { has_dlc = "The Old Gods" }
						}
					}
					character_event = { id = uthgar.19 }
				}
				15 = { # Get injuried
					modifier = {
						factor = 2
						NOT = { combat_rating = 10 }
					}
					modifier = {
						factor = 0
						has_injury_trigger = yes
					}
					character_event = { id = uthgar.20 }
				}
				8 = { # Get maimed
					modifier = {
						factor = 2
						NOT = { combat_rating = 10 }
					}
					modifier = {
						factor = 0
						NOT = { can_be_maimed_trigger = yes }
					}
					character_event = { id = uthgar.21 }
				}
				1 = { # Death
					modifier = {
						factor = 2
						NOT = { combat_rating = 10 }
					}
					character_event = { id = uthgar.22 }
				}
			}
		}
	}
}

character_event = {
	id = uthgar.16
	desc = UTHGAR.16
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.16.a
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.17
	desc = UTHGAR.16
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.16.a
		add_trait = brave
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.18
	desc = UTHGAR.16
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.16.a
		remove_trait = craven
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.19
	desc = UTHGAR.19
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.19.a
		add_trait = berserker
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.20
	desc = UTHGAR.20
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.20.a
		add_trait_wounded_effect = yes
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.21
	desc = UTHGAR.20
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.20.a
		add_maimed_trait_effect = yes
		scaled_prestige = {
			value = 0.25
			min = 50
			max = 350
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.22
	desc = UTHGAR.22
	picture = GFX_evt_melee
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.22.a
		death = { death_reason = death_battle }
	}
}

character_event = {
	id = uthgar.23
	desc = UTHGAR.23
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.23.a
		add_character_modifier = {
			name = runemeet_socialized
			months = 10
		}
		scaled_prestige = {
			value = 0.2
			min = 20
			max = 200
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.24
	desc = UTHGAR.24
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.24.a
		scaled_prestige = {
			value = -0.2
			min = 20
			max = 200
		}
		add_character_modifier = {
			name = runemeet_socialized_failed
			months = 10
		}
		character_event = { id = uthgar.13 random = 2 }
	}
}

character_event = {
	id = uthgar.25
	desc = UTHGAR.25
	picture = GFX_evt_midwinter_blot_oldgods
	
	is_triggered_only = yes
	
	option = {
		name = UTHGAR.25.a
		character_event = { id = uthgar.13 random = 2 }
	}
}